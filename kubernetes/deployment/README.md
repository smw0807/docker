# 디플로이먼트의 역할 이해하기

- 백엔드의 워크로드에 적합하다.
- 주된 역할은 파드의 개수를 관리하는 것이다.
- 요청한 개수만큼 파드를 가동하여, 장애 등의 이유로 파드의 개수가 줄어들면 새롭게 파드를 만들어 기동한다.
- 애플리케이션의 버전을 업그레이드할 때 새로운 버전의 파드로 조금씩 바꾸는 기능도 제공한다.
- 혼자 동작하지 않고 레플리카셋과 함께 동작한다.
- 레플리카셋은 디플로이먼트의 매니페스트에 작성된 레플리카의 값을 기준으로 파드의 개수를 제어한다.

# 디플로이먼트의 생성과 삭제

`kubectl apply -f yaml_file_name`

`kubectl delete -f yaml_file_name`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-deploy
spec: # 디플로이먼트 사양
  replicas: 3 # 생성하고 유지할 파드의 개수
  selector:
    matchLabels: # 컨트롤러와 파드를 대응시키는 라벨
      app: web # 파드에 해당 라벨이 있어야 한다.
  template: # 파드 템플릿
    metadata:
      labels:
        app: web # 파드의 라벨, 컨트롤러의 matchLabels와 일치해야함
    spec: # 컨테이너 사양
      containers:
        - name: nginx
          image: nginx:1.16
```

## 디플로이먼트 사양(Deploymentspec v1 apps)

| 주요 항목 | 설명                                                                                                                                                                                                                                           |
| --------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| replicas  | 파드 템플릿을 사용하여 기동할 파드의 개수를 지정한다. 디플로이먼트는 이 값을 유지하도록 동작한다. 예를 들어, 보수 작업을 위해 노드를 정지시키는 경우, 남아 있는 노드에 파드를 기동해서 기동하는 파드의 개수가 replicas 값과 일치하도록 만든다. |
| selector  | 디플로이먼트 제어하의 레플리카셋과 파드를 대응시키기 위해 matchLabels의 라벨이 사용된다. 이 라벨이 파드 템플릿의 레이블과 일치하지 않으면, kubectl create/apply 시에 에러가 발생한다.                                                          |
| template  | 주요 항목으록 metadata, containers가 있다. metadatas: 상기의 실렉터가 지정하는 라벨과 일치해야 한다. containers: 파드 컨테이너의 사양                                                                                                          |

디플로이먼트의 템플릿은 디플로이먼트에 의해 기동될 파드의 템플릿을 의미한다.
